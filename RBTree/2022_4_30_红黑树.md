# çº¢é»‘æ ‘

> å­¦çº¢é»‘æ ‘ä¹‹å‰é»˜è®¤ä½ å·²ç»ç†Ÿæ‚‰äº†äºŒå‰æœç´¢æ ‘å’ŒAVLæ ‘

## æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯çº¢é»‘æ ‘ï¼Ÿ

>çº¢é»‘æ ‘ï¼ˆRed Black Treeï¼‰ æ˜¯ä¸€ç§è‡ªå¹³è¡¡äºŒå‰æŸ¥æ‰¾æ ‘ï¼Œæ˜¯åœ¨[è®¡ç®—æœº](https://baike.baidu.com/item/è®¡ç®—æœº)ç§‘å­¦ä¸­ç”¨åˆ°çš„ä¸€ç§[æ•°æ®ç»“æ„](https://baike.baidu.com/item/æ•°æ®ç»“æ„/1450)ï¼Œå…¸å‹çš„ç”¨é€”æ˜¯å®ç°[å…³è”æ•°ç»„](https://baike.baidu.com/item/å…³è”æ•°ç»„/3317025)ã€‚ [1] 
>
>çº¢é»‘æ ‘æ˜¯åœ¨1972å¹´ç”±[Rudolf Bayer](https://baike.baidu.com/item/Rudolf Bayer/3014716)å‘æ˜çš„ï¼Œå½“æ—¶è¢«ç§°ä¸ºå¹³è¡¡äºŒå‰Bæ ‘ï¼ˆsymmetric binary B-treesï¼‰ã€‚åæ¥ï¼Œåœ¨1978å¹´è¢« Leo J. Guibas å’Œ Robert Sedgewick ä¿®æ”¹ä¸ºå¦‚ä»Šçš„â€œçº¢é»‘æ ‘â€ã€‚ [2] 
>
>çº¢é»‘æ ‘æ˜¯ä¸€ç§ç‰¹åŒ–çš„AVLæ ‘ï¼ˆ[å¹³è¡¡äºŒå‰æ ‘](https://baike.baidu.com/item/å¹³è¡¡äºŒå‰æ ‘/10421057)ï¼‰ï¼Œéƒ½æ˜¯åœ¨è¿›è¡Œæ’å…¥å’Œåˆ é™¤æ“ä½œæ—¶é€šè¿‡ç‰¹å®šæ“ä½œä¿æŒäºŒå‰æŸ¥æ‰¾æ ‘çš„å¹³è¡¡ï¼Œä»è€Œè·å¾—è¾ƒé«˜çš„æŸ¥æ‰¾æ€§èƒ½ã€‚ [2] 
>
>å®ƒè™½ç„¶æ˜¯å¤æ‚çš„ï¼Œä½†å®ƒçš„æœ€åæƒ…å†µè¿è¡Œæ—¶é—´ä¹Ÿæ˜¯éå¸¸è‰¯å¥½çš„ï¼Œå¹¶ä¸”åœ¨å®è·µä¸­æ˜¯é«˜æ•ˆçš„ï¼š å®ƒå¯ä»¥åœ¨O(log n)æ—¶é—´å†…åšæŸ¥æ‰¾ï¼Œæ’å…¥å’Œåˆ é™¤ï¼Œè¿™é‡Œçš„n æ˜¯æ ‘ä¸­å…ƒç´ çš„æ•°ç›®ã€‚ [2] -- ç™¾åº¦ç™¾ç§‘

ç®€å•æ¥è¯´ï¼Œåœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸ŠåŠ äº†çº¢é»‘ä¸¤ç§é¢œè‰²ï¼Œé€šè¿‡é¢œè‰²çš„è°ƒæ§å¯ä»¥æ§åˆ¶æ ‘çš„é«˜åº¦ï¼Œç”±æ­¤æé«˜äº†æŸ¥æ‰¾æ•ˆç‡ã€‚

> äºŒå‰æœç´¢æ ‘çš„ç¼ºé™·åœ¨äºåœ¨æœ€åæƒ…å†µä¸‹æŸ¥æ‰¾çš„æ•ˆç‡æ˜¯O(N)ï¼Œè¿™ä¸€ç‚¹éƒ½ä¸ä¼˜é›…ğŸ˜³ï¼Œè€Œçº¢é»‘æ ‘è§£å†³äº†è¿™ä¸ªé—®é¢˜ï¼Œæœ€åçš„æƒ…å†µä¸‹çº¢é»‘æ ‘çš„æŸ¥æ‰¾æ•ˆç‡ä¾æ—§æ˜¯O(logn)ï¼

### çº¢é»‘æ ‘çš„æ€§è´¨

1. æ¯ä¸ªç»“ç‚¹é¢œè‰²ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²
2. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²
3. å¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯çº¢è‰²ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­©å­ç»“ç‚¹å¿…ä¸ºé»‘ï¼ˆå³ä¸€æ¡è·¯å¾„ä¸Šä¸ä¼šæœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢ï¼‰
4. æ¯ä¸ªç»“ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹
5. æ¯ä¸ªå¶å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆæ­¤å¤„çš„å¶å­æ˜¯ç©ºç»“ç‚¹ï¼‰

**<font color= #1E90FF>æ€è€ƒä¸‹é¢çš„é—®é¢˜</font>**

- ç¬¬ä¸‰æ¡å’Œç¬¬å››æ¡æ€§è´¨ä¸ºä»€ä¹ˆå¯ä»¥æ¨å‡ºæœ€é•¿è·¯å¾„ä¼šå°äºç­‰äºæœ€çŸ­è·¯å¾„çš„ä¸¤å€ï¼Ÿ

å› ä¸ºç†è®ºä¸Šçº¢é»‘æ ‘ä¸­æœ€çŸ­è·¯å¾„å…¨é»‘ï¼Œæœ€é•¿è·¯å¾„ä¸¤ä¸ªé»‘ä¹‹é—´å¤¹ä¸€ä¸ªçº¢

![image-20220504203441369](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504203441369.png)

> æ­£å› ä¸ºæœ€é•¿è·¯å¾„<=2*æœ€çŸ­è·¯å¾„ï¼Œç”±æ­¤å°±æ§åˆ¶äº†æ ‘çš„é«˜åº¦ï¼Œä¹Ÿè¯´æ˜çº¢é»‘æ ‘ä¸åƒAVLæ ‘é‚£æ ·ä¸¥æ ¼å¹³è¡¡ï¼Œå…¶å®å¯ä»¥é€šè¿‡è®¡ç®—å¯çŸ¥AVLæ ‘çš„å…·ä½“æŸ¥æ‰¾æ•ˆç‡æ˜¯logn,çº¢é»‘æ ‘çš„å…·ä½“æŸ¥æ‰¾æ•ˆç‡æ˜¯2lognï¼Œlognå’Œ2lognçš„æ•ˆç‡ç›¸å·®ä¸å¤§ã€‚å‡è®¾æ•°æ®è§„æ¨¡nä¸ºåäº¿ï¼Œlognä¹Ÿå°±ç­‰äº30å·¦å³ï¼Œ2lognä¹Ÿå°±æ˜¯60,å¯¹äºç°åœ¨çš„CPUæ¥è¯´åŸºæœ¬ä¸Šæ²¡å•¥å·®åˆ«ï¼Œä½†æ˜¯æ„é€ çº¢é»‘æ ‘çš„ä»£ä»·ï¼ˆæ—‹è½¬æ¬¡æ•°ï¼‰å´ä¼šæ¯”æ„é€ AVLæ ‘ä½å¾ˆå¤šï¼Œç”±æ­¤æˆ‘ä»¬å¯çŸ¥çº¢é»‘æ ‘çš„æ•ˆç‡å…¶å®æ˜¯æ¯”AVLæ ‘é«˜çš„ã€‚

- ç¬¬äº”æ¡æ€§è´¨è¯´çš„æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

![image-20220504204058091](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504204058091.png)

- çº¢è‰²ç»“ç‚¹çš„å­©å­å¿…å®šæ˜¯é»‘è‰²ç»“ç‚¹ï¼Œç¡®ä¿äº†çº¢é»‘ç›¸é—´ï¼Œæ‰€ä»¥å¯ä»¥æœ‰è¿ç»­é»‘ï¼Œä½†ä¸å¯èƒ½æœ‰è¿ç»­çº¢


## æ’å…¥

### é“ºå«

- çº¢é»‘æ ‘æ˜¯åœ¨äºŒå‰æœç´¢æ ‘çš„åŸºç¡€ä¸Šï¼Œç”±äºŒå‰æœç´¢æ ‘çš„çŸ¥è¯†å¯çŸ¥æ’å…¥çš„ä½ç½®è‚¯å®šæ˜¯åœ¨ç©ºèŠ‚ç‚¹çš„ä½ç½®ï¼ˆä¹Ÿå°±æ˜¯çš„åœ¨å¶å­çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼‰

- æ–°å¢èŠ‚ç‚¹çš„é¢œè‰²ä¸ºä»€ä¹ˆæ˜¯çº¢è‰²ï¼Ÿ

å‡å¦‚æŠŠæ–°å¢èŠ‚ç‚¹çš„é¢œè‰²è®¾ç½®ä¸ºé»‘è‰²ï¼Œé‚£ä¼šå¯¼è‡´æ¯æ¡è·¯å¾„çš„é»‘è‰²ç»“ç‚¹æ•°ç›®ä¸åŒï¼ˆæ€§è´¨4ï¼‰ï¼Œè°ƒæ•´èµ·æ¥ä»£ä»·å¾ˆå¤§ï¼Œå¦‚æœæŠŠæ–°å¢ç»“ç‚¹è®¾ä¸ºçº¢è‰²ï¼Œå°±å¥½å¤„ç†å¾ˆå¤šï¼Œå› ä¸ºæ’å…¥çº¢è‰²ç»“ç‚¹åªéœ€è€ƒè™‘ä¸è¦å‡ºç°è¿ç»­çš„çº¢è‰²ç»“ç‚¹ï¼ˆæ€§è´¨ä¸‰ï¼‰ã€‚

> ç†è®ºä¸ŠæŠŠæ–°å¢ç»“ç‚¹è®¾ä¸ºé»‘è‰²ä¹Ÿå¯ä»¥è°ƒæ•´ï¼Œä½†æ˜¯æ•ˆç‡è‚¯å®šä¼šæ¯”çº¢è‰²æ›´ä½ã€‚~~å› ä¸ºåœ¨çº¢é»‘æ ‘çš„åˆ é™¤ä¸­ï¼Œæœ€éº»çƒ¦çš„å°±æ˜¯åˆ é™¤åæ¯æ¡è·¯å¾„çš„é»‘è‰²ç»“ç‚¹æ•°ä¸åŒ~~

- è®°ä½ä¸‹é¢å„ä¸ªç»“ç‚¹çš„è¡¨ç¤ºç¬¦å·

![image-20220504210536703](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504210536703.png)

> grandfatherä»…ä»…æ˜¯ä¸€é¢—å­æ ‘çš„æ ¹ï¼Œä¸ä¸€å®šæ˜¯æ•´æ£µæ ‘çš„æ ¹

### æ’å…¥çš„å„ç§æƒ…å†µ

```mermaid
graph LR
X(curä¸ºé»‘)-->Y(ä¸åˆç†)
A(curä¸ºçº¢)--parentä¸ºé»‘-->B(ä¸å¤„ç†)

A--parentä¸ºçº¢-->C(çœ‹uncle)
C--uncleä¸ºçº¢-->D(å˜è‰²+é€’å½’)

D--grandfatherçš„çˆ¶äº²ä¸ºçº¢-->F(å‘ä¸Šé€’å½’)
D--grandfatherçš„çˆ¶äº²ä¸ºé»‘-->G(è°ƒæ•´ç»“æŸ)
B-->G
F--è°ƒæ•´è‡³çˆ¶äº²ä¸ºé»‘/è°ƒæ•´è‡³æ ¹èŠ‚ç‚¹-->G
C--uncleä¸ºé»‘/ä¸å­˜åœ¨-->E(æ—‹è½¬+å˜è‰²)
E--cur,parent,grandfatheråœ¨ä¸€æ¡ç›´çº¿ä¸Š-->I(å•æ—‹+å˜è‰²)
E--cur,parent,grandfatheråœ¨ä¸€æ¡æŠ˜çº¿ä¸Š-->J(åŒæ—‹+å˜è‰²)
I-->G
J-->G
```



1. **<font color= #40E0D0>parentä¸ºé»‘,uncleå’Œgrandfatheréšæ„</font>**

**å¤„ç†**ï¼šä¸åšå¤„ç†ã€‚å¯çŸ¥æ’å…¥æ–°å¢ç»“ç‚¹ä»ç„¶æ˜¯ä¸€æ£µåˆæ ¼çš„çº¢é»‘æ ‘

ä¸‹é¢åˆ—å‡ºparentä¸ºé»‘æ—¶çš„å„ç§æƒ…å†µ

![image-20220504210536703](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504210536703.png)

![image-20220504211225118](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504211225118.png)

![image-20220504211441521](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504211441521.png)



2. **<font color= #40E0D0>parentä¸ºçº¢è‰²ç»“ç‚¹ï¼Œgrandfatherä¸ºé»‘ï¼Œuncleæœªå®š</font>**

> parentä¸ºçº¢ï¼Œgrandparentå¿…ä¸ºé»‘(çº¢é»‘ç›¸é—´çš„æ€§è´¨)ï¼Œæ­¤æ—¶çš„å¤„ç†å–å†³äºuncle
>
> æœ¬è´¨ä¸Šå°±æ˜¯åœ¨å¤„ç†åŒçº¢(è¿ç»­çš„çº¢ç»“ç‚¹)çš„æƒ…å†µ

2.1 uncleä¸ºçº¢

å¤„ç†ï¼šparentå’Œuncleå˜é»‘ï¼Œgrandparentå˜çº¢ï¼Œå†æŠŠcuræŒ‡é’ˆæŒ‡å‘grandparentå‘ä¸Šé€’å½’å¤„ç†

**æŠ½è±¡å›¾**

![image-20220504214143104](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504214143104.png)

**å…·ä½“å›¾**

![image-20220504212247983](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504212247983.png)



> éšç¬”è®°å½•ï¼šæ­¤æ—¶åªéœ€è¦å˜è‰²ä¸éœ€è¦æ—‹è½¬ï¼ˆä¸‹é¢pè¡¨ç¤ºparentï¼Œuè¡¨ç¤ºuncleï¼Œgè¡¨ç¤ºgrandfatherï¼‰
>
> på’Œuéƒ½å¤„ç†ä¸ºé»‘ï¼Œgå¤„ç†ä¸ºçº¢  è¿™æ¡è·¯å¾„æœ¬æ¥å°±æ˜¯ä¸€é»‘ ï¼Œå¤„ç†åä¾æ—§æ˜¯ä¸€é»‘ï¼Œè‹¥æ˜¯gå¤„ç†ä¸ºçº¢åï¼Œ**gçš„çˆ¶äº²ä¹Ÿæ˜¯çº¢ï¼Œåˆ™ä»ç„¶å­˜åœ¨ä¸¤ä¸ªè¿ç»­çš„çº¢ï¼Œåˆ™ç»§ç»­å¤„ç†**
>

2.2 uncleä¸ºé»‘/ä¸å­˜åœ¨

> **<font color=red>è¿™ç§æƒ…å†µè‚¯å®šä¸æ˜¯åˆçŠ¶æ€ï¼Œæ˜¯ç”±æƒ…å†µ2.1å˜æ¥çš„</font>**
>
> åŸå› ï¼š![image-20220504220446361](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504220446361.png)
>
> ä¸­é—´çŠ¶æ€å¯èƒ½æ˜¯æƒ…å†µ2.1å‘ä¸Šé€’å½’å‡ºç°çš„å…¶ä¸­ä¸€ç§æƒ…å†µ

2.2.1 grandfatherã€parentã€curåœ¨ä¸€æ¡ç›´çº¿ä¸Š

å¤„ç†ï¼šå•æ—‹+å˜è‰²

![image-20220504223328351](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504223328351.png)

<font color=red>**æŠ½è±¡å›¾**</font>ï¼š[é«˜æ¸…å›¾ç‰‡](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504222653793.png)

**<font color= #40E0D0>ç¬¬ä¸€æ­¥ï¼šå•æ—‹</font>**

![image-20220504222933165](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504222933165.png)

**<font color= #40E0D0>ç¬¬äºŒæ­¥ï¼šå˜è‰²</font>**

![image-20220504223013265](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504223013265.png)

> è¿™æ˜¯æ–°å¢ç»“ç‚¹åœ¨å·¦å­æ ‘çš„æƒ…å†µï¼Œé‚£åœ¨å³å­æ ‘å‘¢ï¼Ÿå¯ä»¥è‡ªå·±å°è¯•ç”»å›¾å®ç°

2.2.2 grandfatherã€parentã€curåœ¨ä¸€æ¡æŠ˜çº¿ä¸Š

å¤„ç†ï¼šåŒæ—‹+å˜è‰²

![image-20220504224026003](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504224026003.png)

<font color=red>**æŠ½è±¡å›¾**</font>(å‡è®¾curåœ¨grandfatherçš„å·¦å­æ ‘)

**<font color= #40E0D0>ç¬¬ä¸€æ­¥ï¼šä»¥parentä¸ºè½´å·¦æ—‹</font>**

![image-20220504224638765](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504224638765.png)

**<font color= #40E0D0>ç¬¬äºŒæ­¥ï¼šä»¥grandfatherä¸ºè½´å³æ—‹</font>**

![image-20220504224812489](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504224812489.png)

**<font color= #40E0D0>ç¬¬ä¸‰æ­¥ï¼šå˜è‰²</font>**

![image-20220504224907571](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220504224907571.png)

> è¿™æ˜¯curåœ¨grandfatehrçš„å·¦å­æ ‘ä¸”ä¸ºæŠ˜çº¿çš„æƒ…å†µï¼Œå¯ä»¥è‡ªå·±å°è¯•ç”»å‡ºcuråœ¨å³å­æ ‘ä¸”ä¸ºæŠ˜çº¿çš„çŠ¶æ€
>
> éšç¬”è®°å½•ï¼š
>
> å¦‚ä½•å¤„ç†ï¼Ÿæ—‹è½¬+å˜è‰² ï¼›pä¸€å®šè¦ä»çº¢å˜ä¸ºé»‘ï¼› gä¸ºé»‘ï¼Œuä¸ºé»‘è½¬åˆ°ä¸‹é¢å»,å†æŠŠpç”±çº¢è½¬é»‘ï¼Œgå’Œuè½¬åˆ°ä¸‹é¢å»åé»‘è‰²ç»“ç‚¹æ•°ç›®æœ¬æ¥æ˜¯æ²¡å˜çš„ï¼Œä½†æ˜¯å› ä¸ºpæ˜¯ç¥–çˆ¶å˜è‰²äº†ï¼Œå½±å“äº†è¿™æ£µå­æ ‘ï¼Œå°±å¾—æŠŠuç”±é»‘è½¬çº¢å®ç°çº¢é»‘æ ‘çš„å¹³è¡¡
>
> ç¬¬äºŒç§æƒ…å†µå¯ä»¥ç›´æ¥breakäº†ï¼Œç¬¬äºŒç§æƒ…å†µæ—‹è½¬å˜è‰²å®Œcurå‡ºç°åœ¨æœ€ä¸Šé¢ä¸ºé»‘è‰²ï¼Œä¸å¿…ç»§ç»­æ›´æ–°ã€‚
>
> å…¶ä¸­uncleä¸å­˜åœ¨ï¼Œå°±å½“åšä¸ºç©ºå»å†™ï¼Œå› ä¸ºrotateRå’ŒrotateLå·²ç»å¯¹uncleä¸ºç©ºè¿›è¡Œäº†å¤„ç†ï¼Œæ‰€ä»¥ä»£ç å®ç°æ—¶ä¸ä¼šå‡ºç°ç©ºæŒ‡é’ˆè§£å¼•ç”¨çš„æƒ…å†µ

### ä»£ç å®ç°

#### çº¢é»‘æ ‘ç»“ç‚¹

- æšä¸¾ä½“ä¿è¯æ€§è´¨ä¸€ ä¸€å®šæˆç«‹
- ä¸‰å‰é“¾ç»“æ„ï¼Œå’ŒäºŒå‰æœç´¢æ ‘ä¸€æ ·
- æ’å…¥çš„æ˜¯KVé”®å€¼å¯¹ï¼Œæ ¹æ®Kå€¼æ’åº
- ææ„å‡½æ•°é˜²æ­¢å†…å­˜æ³„æ¼ï¼ˆåˆ é™¤è¿‡ç¨‹ä¸­æœ‰ç”¨ï¼‰

```c++
enum Color
{
	RED,
	BLACK
};
template<class K,class V>
struct RBTreeNode
{
	RBTreeNode* _left;
	RBTreeNode* _right;
	RBTreeNode* _parent;

	pair<K, V>_kv;
	int _col;

	RBTreeNode(const pair<K,V>&kv)
		:_left(nullptr)
		,_right(nullptr)
		,_parent(nullptr)
		,_kv(kv)
		,_col(RED)
	{}
	~RBTreeNode()
	{
		_left = nullptr;
		_right = nullptr;
		_parent = nullptr;
		_col = BLACK;
	}
};
```

#### æ’å…¥ä»£ç 

```c++
template<class K,class V>
class RBTree
{
	typedef RBTreeNode<K,V> Node;
public:
	RBTree()
		:_root(nullptr)
	{}
    
	bool Insert(const pair<K, V>& kv)
	{
		if (_root == nullptr)
		{
			_root = new Node(kv);
			_root->_col = BLACK;
			return true;
		}
		Node* cur = _root;
		Node* parent = nullptr;
		while (cur)
		{
			if (kv.first < (cur->_kv).first)
			{
				parent = cur;
				cur = cur->_left;
			}
			else if (kv.first > (cur->_kv).first)
			{
				parent = cur;
				cur = cur->_right;
			}
			else//å­˜åœ¨ç›¸åŒå€¼
			{
				return false;
			}
		}
		cur = new Node(kv);
		if ((cur->_kv).first < (parent->_kv).first)
		{
			parent->_left = cur;
		}
		else
		{
			parent->_right = cur;
		}
		cur->_parent = parent;

		//å¼€å§‹å¤„ç†çº¢é»‘å› å­
		while (parent && parent->_col == RED)
		{
			_root->_col = BLACK;
			Node* grandfather = parent->_parent;
			if (parent == grandfather->_left)//çˆ¶äº²æ˜¯å·¦å­©å­ ä¸ºäº†åˆ¤æ–­æ˜¯ç›´çº¿è¿˜æ˜¯æŠ˜çº¿  ä¸€å…±æœ‰å››ç§å¯èƒ½
			{
				Node* uncle = grandfather->_right;
				if (uncle && uncle->_col == RED)//uncleå­˜åœ¨ä¸”ä¸ºçº¢
				{
					grandfather->_col = RED;
					parent->_col = uncle->_col = BLACK;
					cur = grandfather;
					parent = cur->_parent;
				}
				else //uncleä¸å­˜åœ¨æˆ–è€…uncleä¸ºé»‘
				{
					if (parent->_left == cur)//ç›´çº¿
					{
						RotateR(grandfather);
						parent->_col = BLACK;
						grandfather->_col = RED;
					}
					else//æŠ˜çº¿
					{
						RotateL(parent);
						RotateR(grandfather);
						grandfather->_col = RED;
						cur->_col = BLACK;
					}
					break;
				}
			}
			else//çˆ¶äº²æ˜¯å³å­©å­
			{
				Node* uncle = grandfather->_left;
				if (uncle && uncle->_col == RED)
				{
					parent->_col = uncle->_col = BLACK;
					grandfather->_col = RED;
					cur = grandfather;
					parent = cur->_parent;//è¿­ä»£
				}
				else//uncleä¸å­˜åœ¨æˆ–uncleä¸ºé»‘
				{
					if (parent->_right == cur)
					{
						RotateL(grandfather);
						parent->_col = BLACK;
						grandfather->_col = RED;
					}
					else//æŠ˜çº¿
					{
						RotateR(parent);
						RotateL(grandfather);
						cur->_col = BLACK;
						grandfather->_col = RED;
					}
					break;
				}
			}
		}
		_root->_col = BLACK;
		return true;
	}

	void RotateR(Node* parent)//å³æ—‹
	{
        //subLRæ˜¯å¦å­˜åœ¨
        //parentä¸ºæ ¹æ—¶
        //parentä¸Šé¢è¿˜æœ‰ç»“ç‚¹æ—¶
        //æ›´æ–°subLçš„çˆ¶äº²
		Node* subL = parent->_left;
		Node* subLR = subL->_right;
		parent->_left = subLR;
		if (subLR)
		{
			subLR->_parent = parent;
		}
		Node* ppNode = parent->_parent;
		subL->_right = parent;//subLä¸å¯èƒ½ä¸ºç©º æ—‹è½¬æ—¶å¹³è¡¡å› å­è‚¯å®šä¸º2æˆ–-2 å³è¯¥èŠ‚ç‚¹å¾€ä¸‹ä¸€å±‚ä¸€å®šå­˜åœ¨
		parent->_parent = subL;
		if(parent == _root)
		{
			_root = subL;
			subL->_parent = nullptr;
		}
		else
		{
			if (ppNode->_left == parent)
			{
				ppNode->_left = subL;
			}
			else
			{
				ppNode->_right = subL;
			}
			subL->_parent = ppNode;
		}
		
	}
	void RotateL(Node* parent)//å·¦æ—‹
	{
		Node* subR = parent->_right;
		Node* subRL = subR->_left;
		parent->_right = subRL;
		if (subRL)
		{
			subRL->_parent = parent;
		}
		Node* ppNode = parent->_parent;
		subR->_left = parent;
		parent->_parent = subR;
		if (parent == _root)
		{
			_root = subR;
			subR->_parent = nullptr;
		}
		else
		{
			if (ppNode->_left == parent)
			{
				ppNode->_left = subR;
			}
			else
			{
				ppNode->_right = subR;
			}
			subR->_parent = ppNode;
		}
		
	}
    private:
	Node* _root;
};
```

### åˆ¤æ–­æ˜¯å¦æ˜¯çº¢é»‘æ ‘

æ€è·¯ï¼šæ ¹æ®äº”æ¡æ€§è´¨æ¥åˆ¤æ–­

1. æ¯ä¸ªç»“ç‚¹é¢œè‰²ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²

   <font color=green>æšä¸¾ä½“ç¡®å®š</font>

2. æ ¹èŠ‚ç‚¹æ˜¯é»‘è‰²

   <font color=green>æ¡ä»¶åˆ¤æ–­å³å¯</font>

3. å¦‚æœä¸€ä¸ªç»“ç‚¹æ˜¯çº¢è‰²ï¼Œåˆ™å®ƒçš„ä¸¤ä¸ªå­©å­ç»“ç‚¹å¿…ä¸ºé»‘ï¼ˆå³ä¸€æ¡è·¯å¾„ä¸Šä¸ä¼šæœ‰ä¸¤ä¸ªè¿ç»­çš„çº¢ï¼‰

   <font color=green>åˆ¤æ–­æ˜¯å¦æœ‰è¿ç»­çº¢ï¼Œå€ŸåŠ©parentæŒ‡é’ˆç›´æ¥æ‰¾åˆ°çˆ¶äº²</font>

   > çˆ¶äº²ä¸ºçº¢ï¼Œå­©å­å¯èƒ½ä¸å­˜åœ¨ï¼Œä¸å¥½åˆ¤æ–­æ˜¯å¦æœ‰è¿ç»­çº¢ï¼Œä½†æ˜¯æ¯ä¸ªå­©å­éƒ½åªæœ‰ä¸€ä¸ªçˆ¶äº²ï¼Œæ‰€ä»¥å¦‚æœå­©å­ä¸ºçº¢ï¼Œåˆ¤æ–­å…¶çˆ¶äº²æ˜¯å¦ä¸ºçº¢å³å¯åˆ¤æ–­æ˜¯å¦å…·æœ‰è¿ç»­çº¢ç»“ç‚¹ï¼Œæ‰¾çˆ¶äº²å€ŸåŠ©parentæŒ‡é’ˆ

   ```c++
   	bool CheckRED(Node* root)
   	{
   		if (root == nullptr)
   		{
   			return true;
   		}
   		//å­©å­ä¸ä¸€å®šå­˜åœ¨ï¼Œæ‰€ä»¥æ£€æŸ¥çº¢è‰²ç»“ç‚¹çš„çˆ¶äº²æ˜¯å¦ä¸ºçº¢
   		if (root->_col == RED)
   		{
   			if ((root->_parent)->_col == RED)
   			{
   				cout << "è¿ç»­çš„çº¢è‰²ç»“ç‚¹" << endl;
   				return false;
   			} 
   			//è¿™é‡Œä¸èƒ½ç›´æ¥return  true å› ä¸ºè¿˜è¦æ£€æŸ¥è¿™ä¸ªç»“ç‚¹çš„å­æ ‘æ˜¯å¦å­˜åœ¨è¿ç»­çš„çº¢ç»“ç‚¹
   		}
   		return CheckRED(root->_left)
   			&& CheckRED(root->_right);
   
   	}
   ```

   

4. æ¯ä¸ªç»“ç‚¹ï¼Œä»è¯¥èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„ç®€å•è·¯å¾„ä¸Šï¼Œå‡åŒ…å«ç›¸åŒæ•°ç›®çš„é»‘è‰²ç»“ç‚¹

   <font color=green>è®°å½•éšä¾¿ä¸€æ¡è·¯å¾„çš„é»‘è‰²ç»“ç‚¹ä½œä¸ºåŸºå‡†å€¼ï¼Œæ¯æ¡è·¯å¾„çš„é»‘è‰²ç»“ç‚¹å’ŒåŸºå‡†å€¼å»åšæ¯”è¾ƒ</font>

   ```c++
   
   	bool CheckBlackNums(Node* root,int blackNums,int benchmark)
   	{
           //blackNumsè¡¨ç¤ºä»æ ¹èŠ‚ç‚¹åˆ°å½“å‰èŠ‚ç‚¹çš„è·¯å¾„æœ‰å‡ ä¸ªé»‘è‰²ç»“ç‚¹
   		if (root == nullptr)
   		{
   			if (blackNums == benchmark)
   			{
   				return true;
   			}
   			else
   			{
   				cout << "æ¯æ¡è·¯å¾„ä¸Šé»‘è‰²èŠ‚ç‚¹ä¸ä¸€æ ·" << endl;
   				return false;
   			}		
   		}
   		if (root->_col == BLACK)
   		{
   			blackNums++;
   		}
   		return CheckBlackNums(root->_left,blackNums,benchmark) && CheckBlackNums(root->_right, blackNums, benchmark);
   
   	}
   ```

   

5. æ¯ä¸ªå¶å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²çš„ï¼ˆæ­¤å¤„çš„å¶å­æ˜¯ç©ºç»“ç‚¹ï¼‰

   <font color=green>ä¸å¿…åˆ¤æ–­</font>

**ä»£ç è°ƒç”¨**

```c++

	bool IsBalance()
	{
		if (_root == nullptr)
		{
			return true;
		}
		if (_root->_col == RED)
		{
			cout << "æ ¹èŠ‚ç‚¹ä¸ºçº¢è‰²" << endl;
			return false;
		}
		int benchmark = 0;
		Node* cur = _root;
		while (cur)
		{
			if (cur->_col == BLACK)
			{
				benchmark++;//ç®—åŸºå‡†å€¼
			}
			cur = cur->_left;
		}
		int blacknum = 0;
		return CheckRED(_root)
			&& CheckBlackNums(_root, blacknum, benchmark);
	}
```

## åˆ é™¤



## æ€»ç»“

















èµ°åˆ°ç©ºè¡¨ç¤ºæ˜¯ä¸€æ¡è·¯å¾„ï¼Œç„¶åç®—å‡ºçš„é»‘è‰²ç»“ç‚¹çš„ä¸ªæ•°å’ŒåŸºå‡†å€¼å»æ¯”è¾ƒï¼Œç›¸åŒè¿”å›true,å¦åˆ™è¿”å›false

çº¢è‰²èŠ‚ç‚¹çš„å­©å­ä¸€å®šå¾—æ˜¯é»‘çš„ï¼Œä½†æ˜¯å­©å­ä¸ä¸€å®šå­˜åœ¨ï¼Œä¸å¦‚å»å»æ£€æŸ¥çº¢è‰²ç»“ç‚¹çš„çˆ¶äº²ä¸€å®šæ˜¯é»‘çš„ï¼Œä¸å¦‚å°±å­˜åœ¨è¿ç»­çš„çº¢ï¼Œä¸ç¬¦åˆçº¢é»‘æ ‘å®šä¹‰



ç»™å‡ºä¸€ç³»åˆ—çš„éšæœºå€¼å»è¿›è¡Œæµ‹è¯•



æ—‹è½¬æœ¬è´¨ä¸Šå°±åªæ˜¯æ”¹å˜äº†æ ‘çš„å½¢çŠ¶ï¼Œå¹¶æ²¡æœ‰æ”¹å˜æ ‘çš„æ€§è´¨ï¼ˆäºŒå‰æœç´¢æ ‘ï¼‰

åˆç†çš„æ—‹è½¬å¯ä»¥è¾¾åˆ°é™ä½æ ‘çš„é«˜åº¦ï¼Œåˆå› æœ¬èº«ä¸æ”¹å˜æ ‘çš„æ€§è´¨ï¼Œæ‰€ä»¥åˆç†çš„æ—‹è½¬å¯ä»¥é™ä½æ ‘çš„é«˜åº¦ï¼ˆavlæ ‘ï¼‰



çº¢å˜é»‘==å¢åŠ ä¸€ä¸ªé»‘è‰²ç»“ç‚¹

é»‘å˜çº¢==è€ƒè™‘æ˜¯å¦ä¼šå‡ºç°è¿ç»­çš„äºŒçº¢

![image-20220502124049536](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220502124049536.png)



ä¸ç®¡æ˜¯å•æ—‹è¿˜æ˜¯åŒæ—‹ï¼Œgrandfatheréƒ½è¢«è½¬åˆ°ä¸‹é¢å»äº†ï¼Œé¢œè‰²éƒ½è¢«ç½®ä¸ºçº¢è‰²ï¼ŒæŠŠæ—‹è½¬åçš„æ ¹ç½®ä¸ºé»‘è‰².

> ~~æ„Ÿè§‰ä¸Šï¼Œæ ¹èŠ‚ç‚¹ç½®ä¸ºé»‘è‰²æ›´å¥½æ§åˆ¶å¹³è¡¡ï¼Œå¤šç”»å‡ ä¸ªå›¾ä¼šæœ‰è¿™ç§æ„Ÿè§‰...~~

![image-20220502223719768](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220502223719768.png)

![](https://pic-1304888003.cos.ap-guangzhou.myqcloud.com/img/image-20220502223719768.png)

> çº¢é»‘æ ‘çš„åˆ é™¤ä»£ç å†™äº†ä¸¤å¤©ï¼Œæµ‹è¯•ä»£ç æ™šä¸ŠåäºŒç‚¹åŠè¿‡äº†ï¼ˆå¿˜äº†ä¼ æ˜¨å¤©çš„githubğŸ˜­ï¼‰ï¼Œæˆå°±æ„Ÿæ‹‰æ»¡ï¼--è®°å½•äº2022/5/4/00:30